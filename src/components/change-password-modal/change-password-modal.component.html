<div class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
  <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md" #modal>
    <h3 class="text-2xl font-bold mb-4 text-lime-400">Cambiar Contraseña</h3>
    
    @if (!successMessage()) {
      <form #passwordForm="ngForm" (ngSubmit)="onSave()">
        <div class="space-y-4">
          <div>
            <label for="currentPassword" class="block text-sm font-medium text-gray-300">Contraseña Actual</label>
            <input type="password" name="currentPassword" id="currentPassword" required 
                   [ngModel]="currentPassword()" (ngModelChange)="currentPassword.set($event)"
                   class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md px-3 py-2 focus:ring-lime-400 focus:border-lime-400 text-white"
                   placeholder="••••••••">
          </div>
          <div>
            <label for="newPassword" class="block text-sm font-medium text-gray-300">Nueva Contraseña</label>
            <input type="password" name="newPassword" id="newPassword" required
                   [ngModel]="newPassword()" (ngModelChange)="newPassword.set($event)"
                   class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md px-3 py-2 focus:ring-lime-400 focus:border-lime-400 text-white"
                   placeholder="••••••••">
          </div>
          <div>
            <label for="confirmPassword" class="block text-sm font-medium text-gray-300">Confirmar Nueva Contraseña</label>
            <input type="password" name="confirmPassword" id="confirmPassword" required
                   [ngModel]="confirmPassword()" (ngModelChange)="confirmPassword.set($event)"
                   class="mt-1 w-full bg-gray-700 border-gray-600 rounded-md px-3 py-2 focus:ring-lime-400 focus:border-lime-400 text-white"
                   placeholder="••••••••">
          </div>

          @if (errorMessage()) {
            <div class="p-3 text-sm text-red-300 bg-red-900/50 rounded-lg">
              {{ errorMessage() }}
            </div>
          }
        </div>
        <div class="mt-6 flex justify-end gap-3">
          <button type="button" (click)="onClose()" class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-md hover:bg-gray-500 transition-colors">Cancelar</button>
          <button type="submit" [disabled]="!passwordForm.valid || loading()" class="px-4 py-2 bg-lime-500 text-gray-900 font-semibold rounded-md hover:bg-lime-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            @if (loading()) {
              <span>Guardando...</span>
            } @else {
              <span>Guardar Contraseña</span>
            }
          </button>
        </div>
      </form>
    } @else {
      <div class="text-center py-4">
        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-green-500/20 rounded-full mb-4">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <p class="text-lg text-green-300">{{ successMessage() }}</p>
      </div>
    }
  </div>
</div>